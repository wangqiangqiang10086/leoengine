<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <title></title>
    <script src="lib/jquery-3.2.1.js"></script>
    <script src="lib/lodash.js"></script>
</head>

<body style="margin-left:1200px;margin-top:100px; margin-right:50px;width:1400px;">
    <div style="width:10px;height:1000px;background-color:aqua"></div>
    <div stle="padding:120px;">
        <canvas id="canvas" width="1280" height="640" style="background-color:brown;width:640px;height:320px;"></canvas>
    </div>

    <script>
        var canvas = document.getElementById('canvas');



        var xRate = canvas.width / canvas.offsetWidth;
        var yRate = canvas.height / canvas.offsetHeight;

        var scaleObj = getScale(canvas);

        //testClick();
        //testMouseDown();
        testMouseMove();
        //testMouseUp();

        function testClick() {
            canvas.addEventListener("click", function (e) {
                console.log("click");
                console.log(e);
                console.log({ stageX: e.offsetX * xRate, stageY: e.offsetY * yRate });

                let offset = getOffset(canvas);
                console.log({ stageX: (e.pageX - offset.left) * scaleObj.scaleX, stageY: (e.pageY - offset.top) * scaleObj.scaleY });

                //console.log(e);
            });
        }

        function testMouseDown() {
            canvas.addEventListener("mousedown", function (e) {
                console.log("mousedown");
                console.log(e);
                console.log({ stageX: e.offsetX * xRate, stageY: e.offsetY * yRate });

                let offset = getOffset(canvas);
                console.log({ stageX: (e.pageX - offset.left) * scaleObj.scaleX, stageY: (e.pageY - offset.top) * scaleObj.scaleY });

                //console.log(e);
            });
        }

        function testMouseMove() {
            canvas.addEventListener("mousemove", function (e) {
                console.log("mousemove");
                console.log(e);
                console.log({ stageX: e.offsetX * xRate, stageY: e.offsetY * yRate });

                let offset = getOffset(canvas);
                console.log({ stageX: (e.pageX - offset.left) * scaleObj.scaleX, stageY: (e.pageY - offset.top) * scaleObj.scaleY });

                //console.log(e);
            });
        }

        function testMouseUp() {
            canvas.addEventListener("mouseup", function (e) {
                console.log("mouseup");
                console.log(e);
                console.log({ stageX: e.offsetX * xRate, stageY: e.offsetY * yRate });

                let offset = getOffset(canvas);
                console.log({ stageX: (e.pageX - offset.left) * scaleObj.scaleX, stageY: (e.pageY - offset.top) * scaleObj.scaleY });

                //console.log(e);
            });
        }





        canvas.addEventListener("touchstart", function (e) {
            //console.log(e.changedTouches[0]);
        });
        canvas.addEventListener("touchmove", function (e) {
            //console.log(e);
        });
        canvas.addEventListener("touchend", function (e) {
            //console.log(e);
        });

        function getOffset(domCanvas) {
            var canvasRect = domCanvas.getBoundingClientRect();
            var win = domCanvas.ownerDocument.defaultView;
            return {
                top: canvasRect.top + win.pageYOffset,
                left: canvasRect.left + win.pageXOffset
            };
        }

        function getScale(domCanvas) {
            var canvasRect = domCanvas.getBoundingClientRect();
            return { scaleX: domCanvas.width / canvasRect.width, scaleY: domCanvas.height / canvasRect.height };
        }
    </script>
</body>